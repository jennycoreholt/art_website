YUI.add("hermes-template-photo-list-photo-interaction",function(n,a){var l=n.Template.Handlebars.revive({1:function(n,a,l,e,t){var s;return n.escapeExpression(n.lambda(null!=(s=null!=a?a.photo:a)?s.title:s,a))},3:function(n,a,l,e,t){return n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.UNTITLED"},data:t}))},5:function(n,a,l,e,t){return" "+n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.BY_YOU"},data:t}))},7:function(n,a,l,e,t){var s;return" "+n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{user:null!=(s=null!=(s=null!=a?a.photo:a)?s.owner:s)?s.username:s,intlName:"common.BY_USER"},data:t}))},9:function(n,a,l,e,t){var s,i=null!=a?a:{};return'\t\t<div class="extra-tools">\n'+(null!=(s=l.if.call(i,null!=a?a.removeToolClass:a,{name:"if",hash:{},fn:n.program(10,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(i,null!=a?a.bigScotchTitle:a,{name:"if",hash:{},fn:n.program(12,t,0),inverse:n.noop,data:t}))?s:"")+(null!=(s=l.if.call(i,null!=a?a.moreMenuItems:a,{name:"if",hash:{},fn:n.program(14,t,0),inverse:n.noop,data:t}))?s:"")+"\t\t</div>\n"},10:function(n,a,l,e,t){var s,i,r=n.escapeExpression;return'\t\t\t\t<div class="extra-tool remove-photo '+r("function"==typeof(i=null!=(i=l.removeToolClass||(null!=a?a.removeToolClass:a))?i:l.helperMissing)?i.call(null!=a?a:{},{name:"removeToolClass",hash:{},data:t}):i)+'" data-id='+r(n.lambda(null!=(s=null!=a?a.photo:a)?s.id:s,a))+"></div>\n"},12:function(n,a,l,e,t){var s,i,r=n.escapeExpression;return'\t\t\t\t<div class="extra-tool big-scotch" data-id='+r(n.lambda(null!=(s=null!=a?a.photo:a)?s.id:s,a))+' title="'+r("function"==typeof(i=null!=(i=l.bigScotchTitle||(null!=a?a.bigScotchTitle:a))?i:l.helperMissing)?i.call(null!=a?a:{},{name:"bigScotchTitle",hash:{},data:t}):i)+'"></div>\n'},14:function(n,a,l,e,t){var s,i,r=null!=a?a:{},o=l.helperMissing,u=n.escapeExpression;return'\t\t\t\t<div class="extra-tool more-menu" data-menu-items="'+u("function"==typeof(i=null!=(i=l.moreMenuItems||(null!=a?a.moreMenuItems:a))?i:o)?i.call(r,{name:"moreMenuItems",hash:{},data:t}):i)+'" data-id='+u(n.lambda(null!=(s=null!=a?a.photo:a)?s.id:s,a))+' title="'+u((l.intlMessage||a&&a.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"common.MORE"},data:t}))+'"></div>\n'},16:function(n,a,l,e,t){return" narrow"},18:function(n,a,l,e,t){var s,i=null!=a?a:{};return(null!=(s=l.if.call(i,null!=(s=null!=a?a.photo:a)?s.title:s,{name:"if",hash:{},fn:n.program(19,t,0),inverse:n.program(21,t,0),data:t}))?s:"")+(null!=(s=l.if.call(i,null!=(s=null!=(s=null!=a?a.photo:a)?s.owner:s)?s.displayname:s,{name:"if",hash:{},fn:n.program(23,t,0),inverse:n.program(29,t,0),data:t}))?s:"")},19:function(n,a,l,e,t){var s,i,r=n.escapeExpression;return'\t\t\t\t\t<a href="'+r("function"==typeof(i=null!=(i=l.photoPageUrl||(null!=a?a.photoPageUrl:a))?i:l.helperMissing)?i.call(null!=a?a:{},{name:"photoPageUrl",hash:{},data:t}):i)+'" class="title" tabindex="-1">'+r(n.lambda(null!=(s=null!=a?a.photo:a)?s.title:s,a))+"</a>\n"},21:function(n,a,l,e,t){return'\t\t\t\t\t<span class="title empty"> </span>\n'},23:function(n,a,l,e,t){var s;return'\t\t\t\t\t<a href="'+n.escapeExpression(n.lambda(null!=(s=null!=(s=null!=a?a.photo:a)?s.owner:s)?s.url:s,a))+'" class="attribution">\n'+(null!=(s=(l.photoAttribution||a&&a.photoAttribution||l.helperMissing).call(null!=a?a:{},null!=a?a.photo:a,null!=a?a.flippers:a,{name:"photoAttribution",hash:{},fn:n.program(24,t,0),inverse:n.noop,data:t}))?s:"")+"\t\t\t\t\t</a>\n"},24:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=a?a.intlName:a,{name:"if",hash:{},fn:n.program(25,t,0),inverse:n.program(27,t,0),data:t}))?s:""},25:function(n,a,l,e,t){return"\t\t\t\t\t\t\t\t"+n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{user:null!=a?a.user:a,intlName:null!=a?a.intlName:a},data:t}))+"\n"},27:function(n,a,l,e,t){var s;return"\t\t\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(s=null!=(s=l.user||(null!=a?a.user:a))?s:l.helperMissing)?s.call(null!=a?a:{},{name:"user",hash:{},data:t}):s)+"\n"},29:function(n,a,l,e,t){return'\t\t\t\t\t<span class="attribution empty"> </span>\n'},31:function(n,a,l,e,t){return'\t\t\t\t<span class="title empty"> </span>\n\t\t\t\t<span class="attribution empty"> </span>\n'},33:function(n,a,l,e,t){var s,i,r=null!=a?a:{};return'\t\t<div class="tool'+(null!=(s=l.if.call(r,null!=a?a.isNarrow:a,{name:"if",hash:{},fn:n.program(34,t,0),inverse:n.noop,data:t}))?s:"")+'">\n\t\t\t<a href="'+n.escapeExpression("function"==typeof(i=null!=(i=l.photoPageUrl||(null!=a?a.photoPageUrl:a))?i:l.helperMissing)?i.call(r,{name:"photoPageUrl",hash:{},data:t}):i)+'" class="fave-area" '+(null!=(s=l.if.call(r,null!=a?a.isFaved:a,{name:"if",hash:{},fn:n.program(36,t,0),inverse:n.program(38,t,0),data:t}))?s:"")+" "+(null!=(s=l.unless.call(r,null!=a?a.canFave:a,{name:"unless",hash:{},fn:n.program(40,t,0),inverse:n.noop,data:t}))?s:"")+'>\n\t\t\t\t<i class="fave-star'+(null!=(s=l.if.call(r,null!=a?a.isFaved:a,{name:"if",hash:{},fn:n.program(42,t,0),inverse:n.program(44,t,0),data:t}))?s:"")+(null!=(s=l.unless.call(r,null!=a?a.canFave:a,{name:"unless",hash:{},fn:n.program(46,t,0),inverse:n.noop,data:t}))?s:"")+'"></i>'+(null!=(s=l.if.call(r,null!=a?a.faveCount:a,{name:"if",hash:{},fn:n.program(48,t,0),inverse:n.noop,data:t}))?s:"")+"\n\t\t\t</a>\n\t\t</div>\n"},34:function(n,a,l,e,t){return" lonely"},36:function(n,a,l,e,t){return'aria-label="'+n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:t}))+'"'},38:function(n,a,l,e,t){return'aria-label="'+n.escapeExpression((l.intlMessage||a&&a.intlMessage||l.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.ADD_TO_FAVORITES"},data:t}))+'"'},40:function(n,a,l,e,t){return'tabindex="-1"'},42:function(n,a,l,e,t){return" faved"},44:function(n,a,l,e,t){return" fave"},46:function(n,a,l,e,t){return" can-not-fave"},48:function(n,a,l,e,t){var s;return null!=(s=l.if.call(null!=a?a:{},null!=a?a.faveCount:a,{name:"if",hash:{},fn:n.program(49,t,0),inverse:n.noop,data:t}))?s:""},49:function(n,a,l,e,t){var s;return'<span class="icon-count">'+n.escapeExpression("function"==typeof(s=null!=(s=l.faveCount||(null!=a?a.faveCount:a))?s:l.helperMissing)?s.call(null!=a?a:{},{name:"faveCount",hash:{},data:t}):s)+"</span>"},51:function(n,a,l,e,t){var s,i,r=null!=a?a:{},o=l.helperMissing,u=n.escapeExpression;return'\t\t<div class="tool">\n\t\t\t<a href="'+u("function"==typeof(i=null!=(i=l.photoPageUrl||(null!=a?a.photoPageUrl:a))?i:o)?i.call(r,{name:"photoPageUrl",hash:{},data:t}):i)+'#comments" class="comment-area" aria-label="'+u((l.intlMessage||a&&a.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PLURAL_COMMENT"},data:t}))+'">\n\t\t\t\t<i class="comments"></i>'+(null!=(s=l.if.call(r,null!=a?a.commentCount:a,{name:"if",hash:{},fn:n.program(52,t,0),inverse:n.noop,data:t}))?s:"")+"\n\t\t\t</a>\n\t\t</div>\n"},52:function(n,a,l,e,t){var s;return'<span class="icon-count">'+n.escapeExpression("function"==typeof(s=null!=(s=l.commentCount||(null!=a?a.commentCount:a))?s:l.helperMissing)?s.call(null!=a?a:{},{name:"commentCount",hash:{},data:t}):s)+"</span>"},compiler:[7,">= 4.0.0"],main:function(n,a,l,e,t){var s,i,r=null!=a?a:{};return'<div class="photo-list-photo-interaction">\n\t<a class="overlay" href="'+n.escapeExpression("function"==typeof(i=null!=(i=l.photoPageUrl||(null!=a?a.photoPageUrl:a))?i:l.helperMissing)?i.call(r,{name:"photoPageUrl",hash:{},data:t}):i)+'" tabindex="0" role="heading" aria-level="3" aria-label="'+(null!=(s=l.if.call(r,null!=(s=null!=a?a.photo:a)?s.title:s,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.program(3,t,0),data:t}))?s:"")+(null!=(s=l.if.call(r,null!=(s=null!=a?a.photo:a)?s.isOwner:s,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.program(7,t,0),data:t}))?s:"")+'"></a>\n'+(null!=(s=l.if.call(r,null!=a?a.hasExtraFunctionality:a,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t}))?s:"")+'\t<div class="interaction-bar'+(null!=(s=l.if.call(r,null!=a?a.isNarrow:a,{name:"if",hash:{},fn:n.program(16,t,0),inverse:n.noop,data:t}))?s:"")+'" title="'+(null!=(s=l.if.call(r,null!=(s=null!=a?a.photo:a)?s.title:s,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.program(3,t,0),data:t}))?s:"")+(null!=(s=l.if.call(r,null!=(s=null!=a?a.photo:a)?s.isOwner:s,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.program(7,t,0),data:t}))?s:"")+'">\n\t\t<div class="text">\n'+(null!=(s=l.if.call(r,null!=a?a.displayTitleAndAttribution:a,{name:"if",hash:{},fn:n.program(18,t,0),inverse:n.program(31,t,0),data:t}))?s:"")+"\t\t</div>\n\n"+(null!=(s=l.if.call(r,null!=a?a.displayFaveIcon:a,{name:"if",hash:{},fn:n.program(33,t,0),inverse:n.noop,data:t}))?s:"")+"\n"+(null!=(s=l.if.call(r,null!=a?a.displayComments:a,{name:"if",hash:{},fn:n.program(51,t,0),inverse:n.noop,data:t}))?s:"")+"\t</div>\n</div>\n"},useData:!0}),e={};n.Array.each([],function(a){var l=n.Template.get("hermes/"+a);l&&(e[a]=l)}),n.Template.register("hermes/photo-list-photo-interaction",function(a,t){return t=t||{},t.partials=t.partials?n.merge(e,t.partials):e,l(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-photo-interaction-view",function(e,t){var i=require("hermes-core/type-validator"),n=(require("hermes-core/flog")(t),{css:{faveClickArea:".fave-area",commentClickArea:".comment-area",removeFaveTool:"remove-fave",removePoolTool:"remove-group-pool",removeShowCasePhoto:"remove-showcase-photo",removePhotosOfYou:"remove-photosof-you",scotchTool:"scotch-photo"}});e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=this.appContext.getViewer();return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),t.signedIn&&e.nsid===t.nsid||this.set("viewingSelf",!1),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),e.photoPageUrl&&this.set("photoPageUrl",e.photoPageUrl),this.params=e,this},loadState:function(){var t=[],i=this.get("listModelParams");return t.push(this.appContext.getModel(this.get("engagementModelName"),this.get("id"))),i&&t.push(this.appContext.getModel(i.registryName,i.modelIdOrAttributes)),e.Promise.all(t).then(function(e){var t=e[0],i=e[1];this.set("engagement",t),this.extraFunctionality={moreMenuItems:[]},this.params.removeOwnFaves?this.get("model").getValue("isOwner")&&!this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=n.css.removeFaveTool):this.params.removePoolPhoto?this.get("model").getValue("isOwner")?this.extraFunctionality.removeToolClass=n.css.removePoolTool:i&&(i.getValue("group").getValue("isAdmin")||i.getValue("group").getValue("isModerator"))&&(this.extraFunctionality.removeToolClass=n.css.removePoolTool):this.params.scotch?this.extraFunctionality.removeToolClass=n.css.scotchTool:this.params.removeShowCasePhoto?this.get("model").getValue("isOwner")&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=n.css.removeShowCasePhoto):this.params.removePhotosOfYou&&this.get("viewingSelf")&&(this.extraFunctionality.removeToolClass=n.css.removePhotosOfYou),this.params.excludePeople&&this.extraFunctionality.moreMenuItems.push("exclude-people"),this.params.banUser&&i&&(i.getValue("group").getValue("isAdmin")||i.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("ban-user"),this.params.removeUser&&i&&(i.getValue("group").getValue("isAdmin")||i.getValue("group").getValue("isModerator"))&&this.extraFunctionality.moreMenuItems.push("remove-user"),this.params.searchSimilar&&this.extraFunctionality.moreMenuItems.push("search-similar"),this.params.searchSimilarWithTerm&&this.extraFunctionality.moreMenuItems.push("search-similar-with-term"),this.params.bigScotch&&(this.extraFunctionality.bigScotchTitle=this.godMessage({intlName:"explore.DO_BIG_SCOTCH"})),this.extraFunctionality.moreMenuItems=this.extraFunctionality.moreMenuItems.join(",")}.bind(this))},buildContainer:function(t){var i,n=this.get("engagement"),a=n.getValue("faveCount"),o=n.getValue("isFaved"),s=n.getValue("canFave"),l=n.getValue("commentCount"),r=69,h=!0,g=!0,u=!0,c=!0;return a>=100?r+=50:a>=10?r+=20:a>0&&(r+=12),i=r-18,l>=100?r+=50:l>=10?r+=20:l>0&&(r+=12),this.get("layoutWidth")-r<20&&(h=!1),this.get("layoutWidth")<=r&&(g=!1),this.get("layoutWidth")<=i&&(u=!1),this.get("layoutWidth")<=24&&(c=!1),t=t||{},this.appContext.flipper.isFlipped("enable-intl-numbers")?(a=u?e.IntlNumber.format(a,this.appContext.lang,1):null,l=e.IntlNumber.format(l,this.appContext.lang,1)):(a=u?e.flutil.formatNumbers(a):null,l=e.flutil.formatNumbers(l)),t.photo=this.get("model").toJSON(),t.photoPageUrl=this.get("photoPageUrl"),t.faveCount=a,t.isFaved=o,t.canFave=s,t.commentCount=l,t.displayTitleAndAttribution=h,t.displayComments=g,t.displayFaveIcon=c,t.isNarrow=!g&&!u,t.hasExtraFunctionality=Object.keys(this.extraFunctionality).length>0,t.removeToolClass=this.extraFunctionality.removeToolClass,t.moreMenuItems=this.extraFunctionality.moreMenuItems,t.bigScotchTitle=this.extraFunctionality.bigScotchTitle,this.setContainerWithTemplate("photo-list-photo-interaction",t),this},activate:function(){var e=this.appContext.getViewer(),t=this.get("engagement"),i=this.get("container");return this.get("engagement").getValue("canFave")&&(this.registerEventHandler(t.on("valuesChanged",this.faveStarChanged.bind(this))),this.registerEventHandler(i.delegate("click",this.faveStarClicked.bind(this),n.css.faveClickArea))),!this.signedOutTest||e&&e.signedIn||this.registerEventHandler(i.delegate("click",this.commentClicked.bind(this),n.css.commentClickArea)),this},commentClicked:function(t){var i,n,a=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_TITLE"}),o=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_COMMENT_MESSAGE"}),s=this.get("engagement");t.halt(),e.rapidTracker.beacon(this.name,"commentIconClick"),n=e.url(e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("ownerNsid")})),(i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-comment",signUpTitle:a,signUpMessage:o,beaconPrefix:"comment"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("comment",{postLoginUrl:n})}),i.on("signInClick",function(t){e.SigninHelper._redirectToSignin("comment",{postLoginUrl:n})}),i.show()},showSignUpAndFaveModal:function(t,i){var n,a=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),o=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});(n=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:a,signUpMessage:o,beaconPrefix:"fave"})).on("signUpClick",function(n){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:i})}),n.on("signInClick",function(n){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:i})}),n.show()},faveStarClicked:function(t){var i,n,a,o=this.appContext.getViewer(),s=this.get("engagement"),l=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),r=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),h=this.intlMessage({intlName:"common.CANCEL"}),g=this;if(t.halt(),e.rapidTracker.beacon(this.name,"faveButtonClick"),o&&o.signedIn)this.get("isFaving")||(this.set("isFaving",!0),s.toggleFave(),s.remoteUpdate().then(function(){this.appContext.getModelRegistry("favorite-models").then(function(e){e.proxy(o.nsid).getValue("photoPageList").remove(g.get("model"))}),this.set("isFaving",!1)}.bind(this),function(e){3!==e.code&&s.toggleFave(),this.set("isFaving",!1)}.bind(this)));else{if(n=s.getValue("id"),a=e.url(e.URLHelper.getPhotoPage({photoId:n,pathAlias:s.getValue("ownerNsid")})),this.signedOutTest)return this.showSignUpAndFaveModal(n,a);(i=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:l,actionButtonLabel:r,cancelButtonLabel:h})).on("actionClick",function(){e.rapidTracker.beacon(g.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:n},{postLoginUrl:a})}),i.on("cancelClick",function(t){e.rapidTracker.beacon(g.name,"faveModalCancelClick")}),i.show()}t.halt()},faveStarChanged:function(e){void 0===e.faveCount&&void 0===e.isFaved&&void 0===e.canFave||this.buildContainer()},destructor:function(){}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(e,t){return i.photoId(e)}},model:{writeOnce:"initOnly"},listModelParams:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"},engagement:{value:null},viewingSelf:{value:!0},engagementModelName:{writeOnce:"initOnly",value:null,validator:function(t,i){return e.AttributeHelpers.validateString(t)}},layoutWidth:{validator:function(t,i){return e.AttributeHelpers.validateFloat(t)},setter:function(t){return e.AttributeHelpers.coerceFloat(t)||void 0},defaultFn:function(e){return 0}},isFaving:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-photo-interaction","attribute-helpers","fluid-modal-view","fluid-droparound-view","url","intl-number"],optionalRequires:["fluid"],langBundles:["fave-view","common","photo-page-scrappy"]});YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["You must be signed in to fave. Please sign in now."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"],SIGN_IN_BEFORE_FAVE_TITLE:["You found a photo to fave!"],SIGN_IN_BEFORE_FAVE_MESSAGE:["That's great. Just sign in to fave it."],SIGN_IN_AND_FAVE:["Sign in and fave"],JOIN_FLICKR_AND_FAVE:["Join Flickr to add this photo to your favorites."]})},"@VERSION@",{requires:["intl"]});
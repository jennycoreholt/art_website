YUI.add("hermes-template-albums-list-page",function(t,e){var a=t.Template.Handlebars.revive({1:function(t,e,a,l,n){var s;return null!=(s=a.if.call(null!=e?e:{},null!=e?e.isViewingSelf:e,{name:"if",hash:{},fn:t.program(2,n,0),inverse:t.program(4,n,0),data:n}))?s:""},2:function(t,e,a,l,n){var s=null!=e?e:{},i=a.helperMissing,u=t.escapeExpression;return'\t\t<div class="photolist-empty">\n\t\t\t<h4>'+u((a.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"magic-empty-states.ALBUM_EMPTY"},data:n}))+'</h4>\n\t\t\t<a class="butt medium" href="/photos/organize/?start_tab=sets">'+u((a.intlMessage||e&&e.intlMessage||i).call(s,{name:"intlMessage",hash:{intlName:"magic-empty-states.ALBUM_EMPTY_ACTION"},data:n}))+"</a>\n\t\t</div>\n"},4:function(t,e,a,l,n){return'\t\t<div class="photolist-empty">\n\t\t\t<h4>'+t.escapeExpression((a.intlMessage||e&&e.intlMessage||a.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"magic-empty-states.ALBUM_EMPTY_OTHER"},data:n}))+"</h4>\n\t\t</div>\n"},6:function(t,e,a,l,n){return"\t\t"+t.escapeExpression((a.outlet||e&&e.outlet||a.helperMissing).call(null!=e?e:{},null!=e?e["pagination-view"]:e,{name:"outlet",hash:{},data:n}))+"\n"},compiler:[7,">= 4.0.0"],main:function(t,e,a,l,n){var s,i=null!=e?e:{},u=a.helperMissing,o=t.escapeExpression;return o((a.outlet||e&&e.outlet||u).call(i,null!=e?e["global-nav-view"]:e,{name:"outlet",hash:{},data:n}))+"\n\n"+o((a.outlet||e&&e.outlet||u).call(i,null!=e?e["fluid-header"]:e,{name:"outlet",hash:{},data:n}))+"\n"+o((a.outlet||e&&e.outlet||u).call(i,null!=e?e["fluid-magic-subnav-view"]:e,{name:"outlet",hash:{},data:n}))+"\n\n"+o((a.outlet||e&&e.outlet||u).call(i,null!=e?e["album-list-toolbar-view"]:e,{name:"outlet",hash:{},data:n}))+'\n\n<div role="main" class="albums-list-container fluid-centered">\n'+(null!=(s=a.if.call(i,null!=e?e.isEmpty:e,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n}))?s:"")+"\t"+o((a.outlet||e&&e.outlet||u).call(i,null!=e?e["photo-list-view"]:e,{name:"outlet",hash:{},data:n}))+"\n\n\n"+(null!=(s=a.if.call(i,null!=e?e.showPagination:e,{name:"if",hash:{},fn:t.program(6,n,0),inverse:t.noop,data:n}))?s:"")+"\n</div>\n"+o((a.outlet||e&&e.outlet||u).call(i,null!=e?e["signup-footer-view"]:e,{name:"outlet",hash:{},data:n}))+"\n"+o((a.outlet||e&&e.outlet||u).call(i,null!=e?e["footer-full-view"]:e,{name:"outlet",hash:{},data:n}))+"\n"},useData:!0}),l={};t.Array.each([],function(e){var a=t.Template.get("hermes/"+e);a&&(l[e]=a)}),t.Template.register("hermes/albums-list-page",function(e,n){return n=n||{},n.partials=n.partials?t.merge(l,n.partials):l,a(e,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fluid-share-album-view",function(e,t){var a=require("hermes-core/flog")(t);e.namespace("Views").FluidShareAlbumView=e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.albumId=e.albumId,this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-album-icon",sharingDisabled:!0,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_ALBUM"})}),this.constructor.superclass.initializer.call(this,e)},loadState:function(){return e.Promise.resolve()},getItemCount:function(){return this.loadRequiredModels()},loadRequiredModels:function(){var t=this;return e.Promise.all([this.appContext.getModel("set-models",this.albumId+"-1",{filter:1,perPage:5,page:1}),this.appContext.getModel("album-privacy-models",this.albumId),this.appContext.getModel("set-models",this.albumId)]).then(function(e){t.set("albumModel",e[0]),t.set("privacyModel",e[1]),t.isDisabled=0===e[0].getValue("canShare"),t.set("photos",e[0].getValue("photoPageList").getList()),t.set("fullAlbum",e[2]),e[2].on("valuesChanged",function(e){var a={};e&&(Object.keys(e).forEach(function(l){var r=e[l];r.id===t.albumId&&(a[l]=r.newVal)}),Object.keys(a).length>0&&t.get("albumModel").setValues(a))})},function(e){a.error("failed to get models",{err:e})})},buildContainer:function(){return this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-album-icon",sharingDisabled:this.isDisabled,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_ALBUM"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("albumModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("fullAlbum");return{url:e.URLHelper.getShortAlbumURL(t.getValue("normalizedId")),title:t.getValue("title")}},prepareTumblrShareParameters:function(){var e=this.get("fullAlbum");return{title:e.getValue("title"),authorURL:e.getValue("owner").getValue("url"),ownerName:e.getValue("owner").getValue("displayname"),description:e.getValue("description"),displayPhotoURL:this.get("photos").map(function(e){return e.getLargestSize().url}),url:e.getValue("url"),tags:"Flickr"}},preparePinterestShareParameters:function(){var t=this.get("fullAlbum");return{title:t.getValue("title"),description:t.getValue("description"),displayPhotoURL:this.get("photos").length>0?this.get("photos")[0].getLargestSize().url:null,shortURL:e.URLHelper.getShortAlbumURL(t.getValue("normalizedId")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("fullAlbum");return{modelName:"set",modelId:this.albumId,modelOwnerId:e.getValue("owner").id,title:e.getValue("title"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t,a,l,r=this.get("albumModel"),i=this.get("fullAlbum"),s=!1;if(t=this.intlMessage({intlName:"share-modal.ALBUM_PRIVACY_WARNING",photoCount:i.getValue("totalCount")}),this.appContext.flipper.isFlipped("enable-album-download")&&i.getValue("owner").getValue("isMe")){switch(s=!0,this.appContext.getViewer().prefs.downloadAccessPref){case 4:l="ALBUM_DOWNLOAD_ACCESS_YOU";break;case 3:l="ALBUM_DOWNLOAD_ACCESS_FF";break;case 2:l="ALBUM_DOWNLOAD_ACCESS_FOLLOWING";break;case 1:l="ALBUM_DOWNLOAD_ACCESS_MEMBERS";break;case 0:l="ALBUM_DOWNLOAD_ACCESS_EVERYONE"}l&&(a=this.intlMessage({intlName:"share-modal."+l,photoCount:i.getValue("totalCount")}))}return{sizes:r.getValue("primaryPhotoSizes"),url:i.getValue("url"),title:i.getValue("title"),author:i.getValue("owner").getValue("displayname"),authorURL:i.getValue("owner").getValue("url"),albumId:r.getValue("normalizedId"),shortURL:e.URLHelper.getShortAlbumURL(i.getValue("normalizedId")||i.getValue("id")),supportsEmbedr:2===i.getValue("canShare")&&this.appContext.flipper.isFlipped("enable-embedr-in-share")&&this.appContext.flipper.isFlipped("enable-embedr-in-albums"),supportsBBCode:!1,privacyWarningString:t,showDownloadWarning:s,downloadAccessString:a}},getTitleIntlKey:function(){return"SHARE_ALBUM_TO"},getGuestPassParams:function(){var e=this.get("privacyModel"),t=this.get("fullAlbum").getValue("owner").getValue("isMe"),a=e.getValue("countPhotosPublic"),l=e.getValue("countPhotosFriendFamily"),r=e.getValue("countPhotosFriend"),i=e.getValue("countPhotosFamily"),s=this.get("privacyModel").getValue("totalCount")-a,u=t&&l>0&&l!==a,o=t&&r>0&&r!==a,n=t&&i>0&&i!==a,d=!1;return u&&r===l&&(o=!1),u&&i===l&&(n=!1),(s>0||u||n||o)&&(d=!0),{type:"set",id:this.get("albumModel").getValue("normalizedId"),contentMarkedFriends:o,contentMarkedFamily:n,contentMarkedFriendFamily:u,contentMarkedPublic:a,canSharePrivate:d&&t,showGuestPassDropdown:t&&a!==this.get("fullAlbum").getValue("totalCount"),multipleItems:!0}},getIsMine:function(){return this.get("albumModel").getValue("isOwner")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper"],langBundles:[]});YUI.add("hermes-template-album-list-toolbar",function(a,e){var l=a.Template.Handlebars.revive({1:function(a,e,l,s,n){var t,i=null!=e?e:{},r=l.helperMissing,c=a.escapeExpression;return'\t\t<a class="create-album" href="/photos/organize/?start_tab=new_set"><i></i><span>'+c((l.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"album-page.NEW_ALBUM"},data:n}))+'</span></a>\n\t\t<div class="divider"></div>\n\t\t<a class="create-collection" href="/photos/organize/?start_tab=sets"><i></i><span>'+c((l.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"album-page.NEW_COLLECTION"},data:n}))+'</span></a>\n\t\t<a class="view-collections" href="'+c(a.lambda(null!=(t=null!=e?e.urls:e)?t.collections:t,e))+'"><span>'+c((l.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"album-page.VIEW_MY_COLLECTIONS"},data:n}))+"</span></a>\n"},3:function(a,e,l,s,n){var t,i=a.escapeExpression;return'\t\t<a class="view-collections" href="'+i(a.lambda(null!=(t=null!=e?e.urls:e)?t.collections:t,e))+'"><span>'+i((l.intlMessage||e&&e.intlMessage||l.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"album-page.VIEW_COLLECTIONS"},data:n}))+"</span></a>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,l,s,n){var t;return'<div class="album-toolbar-content">\n'+(null!=(t=l.if.call(null!=e?e:{},null!=e?e.isViewingSelf:e,{name:"if",hash:{},fn:a.program(1,n,0),inverse:a.program(3,n,0),data:n}))?t:"")+"</div>\n"},useData:!0}),s={};a.Array.each([],function(e){var l=a.Template.get("hermes/"+e);l&&(s[e]=l)}),a.Template.register("hermes/album-list-toolbar",function(e,n){return n=n||{},n.partials=n.partials?a.merge(s,n.partials):s,l(e,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("album-list-toolbar-view",function(i){i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{},initializer:function(i){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.nsid=i.nsid,this},loadState:function(){return this.appContext.getModel("person-models",this.nsid).then(function(i){this.set("person",i),this.set("isViewingSelf",this.nsid===this.appContext.getViewer().nsid)}.bind(this),function(i){})},buildContainer:function(){var t=this.get("person")&&i.URLHelper.generatePersonUrls(this.get("person"));return this.setContainerWithTemplate("album-list-toolbar",{urls:t,isViewingSelf:this.get("isViewingSelf")}),this},buildErrorContainer:function(){},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","url-helper","hermes-template-album-list-toolbar"],optional:[],langBundles:["album-page","common"]});YUI.add("albums-list-page-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("albums-list-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.nsid=t.nsid,this.isOwner=t.isOwner,this.withSetId=t.withSetId,this.pageParams=t.pageParams,t.modelRegistryName="sets-models",t.isViewingSelf=!!this.appContext.getViewer().signedIn&&this.nsid===this.appContext.getViewer().nsid,t.photoListConfig={modelParams:{registryName:"sets-models",modelIdOrAttributes:t.nsid,collectionAttributeName:"albumsList"},interactionViewName:"photo-list-album-interaction-view",engagementModelName:"set-models",viewBeaconRestrictedAttribute:"primaryNeedsInterstitial",parentName:this.name,pageParams:t.pageParams,viewBeaconAttribute:"primary",measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:t.withSetId},t.photoListConfig.layout={targetRowHeight:240,forceAspectRatio:1,containerPadding:{top:8,right:0,bottom:8,left:0},itemSpacing:{horizontal:32,vertical:32}},this.isMobile&&(t.photoListConfig.layout.targetRowHeight=200,t.photoListConfig.layout.containerPadding.right=16,t.photoListConfig.layout.containerPadding.left=16,t.photoListConfig.layout.itemSpacing.horizontal=16,t.photoListConfig.layout.itemSpacing.vertical=16),t.subnavConfig={selected:"albums"},this.aftHelper=new e.PhotolistAftHelper(this),this.doOffline=!!this.appContext.flipper.isFlipped("enable-offline-downloadr"),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"fluid-photostream-coverphoto-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-list-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["fluid-centered"]},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("sets-models",this.nsid),this.appContext.getModel("person-models",this.nsid)]).then(function(e){t.set("albumsListModel",e[0]),t.set("totalItems",e[0].getValue("totalItems")),t.set("owner",e[1])})},buildContainer:function(){var e,t,i=this.get("totalItems");return t=this.pageParams.page>1||i>Math.abs((this.pageParams.viewPageSize||20)*(this.pageParams.page||1)),e=i>0,this.setContainerWithTemplate("albums-list-page",{"fluid-header":this.subviews["fluid-photostream-coverphoto-view"]?this.subviews["fluid-photostream-coverphoto-view"].get("container"):"","album-list-toolbar-view":e?this.subviews["album-list-toolbar-view"].get("container"):"",showPagination:t,isEmpty:0===this.get("totalItems").length,isViewingSelf:this.nsid===this.appContext.getViewer().nsid}),this},buildHeadContainer:function(){var e="";e+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),e+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),e+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",e):(this.set("headContainer",this.subviews["pagination-view"].get("headContainer")),this.updateHead())},showErrorModal:function(t){new e.Views.FluidModal({appContext:this.appContext,darkOverlay:!0,dismissOnOverlayClick:!0,showCancelButton:!1,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),title:this.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),message:t}).show()},createBook:function(t){var i=this;return this.showBalls(),e.rapidTracker.beacon(this.name,"createBook"),this.appContext.getModelRegistry("book-models").then(function(e){return e.remoteCreate({photoset_id:t}).then(function(e){i.hideBalls(),i.appContext.flapp.navigate("/create/books/"+e.id+"/cover")})}).catch(function(e){i.hideBalls(),i.showErrorModal("There was a problem creating the book. Please try again later")})},showBalls:function(){this.balls||(this.balls=e.Node.create('<div class="loading-balls"></div>'),this.balls.setHTML(this.templates("flickr-balls")({}))),this.get("container").append(this.balls)},hideBalls:function(){this.balls.remove()},downloadAlbum:function(t){var i,o,a,s=this,n=!!this.appContext.flipper.isFlipped("enable-offline-downloadr");if(e.rapidTracker.beacon(this.name,"openDownloadAlbum"),(a=e.Array.find(this.get("albumsListModel").getOwnedModels(),function(e){return e.id===t}))&&this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===a.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),n){if(1===a.getValue("totalCount"))return a.getValue("photoPageList").getPage({page:1,perPage:1}).then(function(t){var i,o,a,s=t[0];s.getValue("isVideo")?o="/video_download.gne?id="+s.id:(i=(a=s.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),o="https:"+a.join(".")+"_d."+i),e.config.doc.location.href=o});if(a.getValue("totalCount")>e.config.flickr.downloadr.max_album_items)return e.rapidTracker.beacon(this.name,"albumListDownloadTooMany"),this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:a.getValue("owner").getValue("displayname"),userurl:a.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+a.id}),this.intlMessage({intlName:"downloadr.TOO_MANY_TITLE"}),!0);o=s.bulkDownloaderView.createTitle(a.getValue("photoCount"),a.getValue("videoCount")),s.bulkDownloaderView.showDownloadDialog({doOffline:!0,title:o,setID:t})}else i=this.bulkDownloaderView.showLoadingDialog(),this.bulkDownloaderView.prepareArchive({set_id:t}).then(function(e){i.close(),s.bulkDownloaderView.showDownloadDialog(e)}).catch(function(e){i.close(),s.bulkDownloaderView.onError(e)})},shareAlbum:function(t,i){var o=new e.Views.FluidShareAlbumView({appContext:this.appContext,albumId:t});this.showBalls(),e.rapidTracker.beacon(this.name,"openShareAlbum"),o.on("sharePresentationClose",o.destroy.bind(o)),o.initialize().then(function(){this.prepareModal(i)}.bind(o)).then(function(){this.hideBalls()}.bind(this)).catch(function(e){this.hideBalls()}.bind(this))},deleteAlbum:function(t){var o=this;return e.rapidTracker.beacon(this.name,"deleteAlbum"),this.showBalls(),this.confirmAlbumDelete(t).then(function(){return o.appContext.getModel("set-models",t).then(function(i){var a=[];return i.toJSON().photoPageList.forEach(function(e){a.push(o.appContext.getModel("photo-sets-models",e.id).then(function(e){e.getValue("sets").removeFromList(t)}))}),a.push(i.registry.remoteDelete(t).then(function(){o.get("albumsListModel").getValue("albumsList").remove(t),o.appContext.flapp.navigate(e.config.doc.location.href)})),e.Promise.all(a)})}).catch(function(e){i.error("Error deleting album",{err:e}),o.hideBalls()})},confirmAlbumDelete:function(t){var i=this;return e.rapidTracker.beacon(this.name,"deleteConfirm"),new e.Promise(function(t,o){var a=new e.Views.FluidModal({appContext:i.appContext,title:i.intlMessage({intlName:"common.CONFIRMATION"}),message:i.intlMessage({intlName:"album-page.CONFIRM_ALBUM_DELETE_NO_CONTENTS_DELETED"})});i.registerEventHandler(a.on("actionClick",function(){t()})),i.registerEventHandler(a.on("cancelClick",function(){e.rapidTracker.beacon(i.name,"cancelDeleteConfirm"),o()})),a.show()})},handleClick:function(e){var t,i=e.target;i.hasClass("cta")&&(e.halt(),t=i.ancestor(".photo-list-album-interaction").getData("albumId"),i.hasClass("is-disabled")||(i.hasClass("share")?this.shareAlbum(t,i):i.hasClass("book")?this.appContext.flipper.isFlipped("enable-blurb-photobooks-links")?this.appContext.flapp.navigate("/create"):this.createBook(t):i.hasClass("download")?this.downloadAlbum(t):i.hasClass("trash")&&this.deleteAlbum(t)))},destructor:function(){this.balls&&this.balls.inDoc()&&this.balls.remove(),this.balls=null,this.bulkDownloaderView&&this.bulkDownloaderView.destroy()},activate:function(){return this.registerEventHandler(this.get("container").on("click",this.handleClick,this)),this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext,doOffline:this.doOffline}),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.handlePageResize.bind(this))),this},handlePageResize:function(){e.config.win.innerWidth<=700?this.hasBeenMobilized||(this.hasBeenMobilized=!0,this.subviews["photo-list-view"].photoListLayout.targetRowHeight=200,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=16,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=16,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=16):(this.hasBeenMobilized&&(this.subviews["photo-list-view"].photoListLayout.targetRowHeight=240,this.subviews["photo-list-view"].photoListLayout.containerPadding.right=0,this.subviews["photo-list-view"].photoListLayout.containerPadding.left=0,this.subviews["photo-list-view"].photoListLayout.itemSpacing.horizontal=32,this.subviews["photo-list-view"].photoListLayout.itemSpacing.vertical=32),this.hasBeenMobilized=!1)},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,vwrOwner:this.isOwner?1:0}},onError:function(t,i,o){var a;return a={appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),darkOverlay:!0},a[o?"htmlMessage":"message"]=t,this.errorDialog=new e.Views.FluidModal(a),this.errorDialog.show(),this.errorDialog}},{ATTRS:{spaceid:{value:792600578}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-albums-list-page","global-nav-view","footer-full-view","pagination-view","fluid-photostream-coverphoto-view","fluid-share-album-view","hermes-template-flickr-balls","album-list-toolbar-view","hermes-template-head-link","photolist-aft-helper","hermes-template-head-meta"],optionalRequires:["bulk-downloader-view"],optional:["sets-models","book-models"],langBundles:["album-page","common","downloadr","magic-empty-states","meta"]});YUI.add("hermes-lang-downloadr",function(e,a){e.Intl.add("hermes/downloadr","en-US",{DOWNLOAD_WHEN_READY:["We'll zip up these items and send you a FlickrMail with a link to download them when they are ready."],DOWNLOAD_WHEN_READY_LOGGED_OUT:["We'll zip up these items and give you a link to download them when they are ready."],BE_SURE_RIGHTS:["These items belong to another Flickr member and they own the copyright. Be sure you respect the license on each of these items."],CREATE_ZIP:["Create zip file"],CREATING_ZIP:["Creating your zip file...<br>keep this window open"],CREATING_ZIP_LOGGED_IN:["Creating your zip file...<br>"],HAVE_QUESTIONS:['Have questions? Visit the <a target="_blank" href="',"${url}",'">download help page</a> or the <a target="_blank" href="/forum">Flickr Help Forum</a>.<br>No worries, links open in a new window.'],PLEASE_WAIT:["Please wait"],DOWNLOADS_READY:[{type:"plural",valueName:"num",options:{one:"Your zip file of ${#} items is ready to download",other:"Your zip files of ${#} items are ready to download"}}],DOWNLOAD_ZIP_FILE:["Download zip file"],DOWNLOAD_ZIP_FILES:["Download zip file ",{type:"number",valueName:"num"}],POLLING_ERROR:["An error occured retrieving this download.  Please try again later."],FAILED:["Failed"],FAILED_DOWNLOAD:["Creating the zip file has failed.<br>Please try again later."],TOOLTIP_DOWNLOAD_LINK_MESSAGE:['A FlickrMail with your download link will appear here shortly or <a target="_blank" href="',"${url}",'">view the progress</a>.'],TOOLTIP_OK:["OK, thanks"],CAMERAROLL_TOO_MANY:["We can only process <b>up to 500 photos</b> from the Camera Roll at a time. Please select fewer photos and try again."],TOO_MANY_TITLE:["Whoa, that's a lot of photos!"],ALBUM_TOO_MANY_OWN:['We can only process albums with <b>fewer than 5,000 photos</b>. Please use <a target="_blank" href="/cameraroll">Camera Roll</a> or <a target="_blank" href="',"${url}",'">Organizr</a> to create smaller albums or to remove photos from this one, then try again.'],ALBUM_TOO_MANY_OTHER:['We can only process albums with <b>fewer than 5,000 photos</b>. Please ask <a target="_blank" href="',"${userurl}",'">',"${username}","</a> to create smaller albums or to remove photos from this one, then try again."]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-template-bulk-download-modal",function(n,a){var e=n.Template.Handlebars.revive({1:function(n,a,e,l,t){var s,r=null!=a?a:{};return"\t<p>"+(null!=(s=e.if.call(r,null!=a?a.loggedOut:a,{name:"if",hash:{},fn:n.program(2,t,0),inverse:n.program(4,t,0),data:t}))?s:"")+'</p>\n\n\t<p class="copyright">'+(null!=(s=e.unless.call(r,null!=a?a.isOwnAlbum:a,{name:"unless",hash:{},fn:n.program(6,t,0),inverse:n.noop,data:t}))?s:"")+"</p>\n\n"},2:function(n,a,e,l,t){return n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"downloadr.DOWNLOAD_WHEN_READY_LOGGED_OUT"},data:t}))},4:function(n,a,e,l,t){return n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"downloadr.DOWNLOAD_WHEN_READY"},data:t}))},6:function(n,a,e,l,t){return n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"downloadr.BE_SURE_RIGHTS"},data:t}))},8:function(n,a,e,l,t){var s,r=null!=a?a:{};return"\n"+(null!=(s=e.unless.call(r,null!=a?a.isOwnAlbum:a,{name:"unless",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=a?a.isMany:a,{name:"if",hash:{},fn:n.program(11,t,0),inverse:n.noop,data:t}))?s:"")+"\n"+(null!=(s=e.if.call(r,null!=a?a.isMany:a,{name:"if",hash:{},fn:n.program(13,t,0),inverse:n.program(16,t,0),data:t}))?s:"")},9:function(n,a,e,l,t){return"\t\t<p>"+n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"album-page.DOWNLOAD_ALBUM_LICENSE_MESSAGE_ALT_2"},data:t}))+"</p>\n"},11:function(n,a,e,l,t){return"\t\t<p>"+n.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"album-page.ALOT_OF_PHOTOS"},data:t}))+"</p>\n"},13:function(n,a,e,l,t){var s;return"\t\t<ul>\n"+(null!=(s=e.each.call(null!=a?a:{},null!=a?a.downloadURLs:a,{name:"each",hash:{},fn:n.program(14,t,0),inverse:n.noop,data:t}))?s:"")+"\t\t</ul>\n"},14:function(n,a,e,l,t){var s,r=null!=a?a:{},i=e.helperMissing,u=n.escapeExpression;return"\t\t\t\t<li>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t"+u((e.intlMessage||a&&a.intlMessage||i).call(r,{name:"intlMessage",hash:{partSequence:null!=a?a.partSequence:a,intlName:"album-page.DOWNLOAD_ZIP_PART"},data:t}))+'\n\t\t\t\t\t</span>\n\t\t\t\t\t<a class="butt mini" href="'+u("function"==typeof(s=null!=(s=e.url||(null!=a?a.url:a))?s:i)?s.call(r,{name:"url",hash:{},data:t}):s)+'">'+u((e.intlMessage||a&&a.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"common.DOWNLOAD"},data:t}))+"</a>\n\t\t\t\t</li>\n"},16:function(n,a,e,l,t){var s,r,i=n.escapeExpression;return'\t\t<a class="butt mini" href="'+i(n.lambda(null!=(s=null!=(s=null!=a?a.downloadURLs:a)?s[0]:s)?s.url:s,a))+'">'+i("function"==typeof(r=null!=(r=e.buttonLabel||(null!=a?a.buttonLabel:a))?r:e.helperMissing)?r.call(null!=a?a:{},{name:"buttonLabel",hash:{},data:t}):r)+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(n,a,e,l,t){var s;return null!=(s=e.if.call(null!=a?a:{},null!=a?a.doOffline:a,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.program(8,t,0),data:t}))?s:""},useData:!0}),l={};n.Array.each([],function(a){var e=n.Template.get("hermes/"+a);e&&(l[a]=e)}),n.Template.register("hermes/bulk-download-modal",function(a,t){return t=t||{},t.partials=t.partials?n.merge(l,t.partials):l,e(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-download-tooltip",function(n,e){var a=n.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(n,e,a,t,l){var r,i=null!=e?e:{},o=a.helperMissing,s=n.escapeExpression;return"<div>\n\t"+s("function"==typeof(r=null!=(r=a.content||(null!=e?e.content:e))?r:o)?r.call(i,{name:"content",hash:{},data:l}):r)+'\n\t<br/>\n\t<br/>\n\t<a class="close-onboarding">'+s("function"==typeof(r=null!=(r=a.confirmationLink||(null!=e?e.confirmationLink:e))?r:o)?r.call(i,{name:"confirmationLink",hash:{},data:l}):r)+"</a>\n</div>\n"},useData:!0}),t={};n.Array.each([],function(e){var a=n.Template.get("hermes/"+e);a&&(t[e]=a)}),n.Template.register("hermes/download-tooltip",function(e,l){return l=l||{},l.partials=l.partials?n.merge(t,l.partials):t,a(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("bulk-downloader-view",function(e,t){"use strict";e.BulkDownloaderView=e.Base.create("BulkDownloaderView",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.localizeLib=e.mix({langBundles:["common","album-page","cameraroll"],appContext:this.appContext},e.Localizable),this.set("isOwnAlbum",t.isOwnAlbum),this.doOffline=!!t.doOffline},showLoadingDialog:function(){return new e.Views.FluidModal({appContext:this.appContext,showCancelButton:!1,showFooter:!1,showActionButton:!1,title:this.intlMessage({intlName:"cameraroll.PREPARING_DOWNLOAD"}),message:this.templates("flickr-balls")({}),classList:"bulk-download-loading-dialog"}).show()},createTitle:function(e,t){var o="";if(e=e||0,t=t||0,e>0&&t>0)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS_AND_VIDEO",photoCount:e,videoCount:t});else if(e>0&&0===t)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e});else{if(!(0===e&&t>0))throw new Error(this.intlMessage({intlName:"cameraroll.DOWNLOAD_NOT_AVAILABLE_ERROR"}));o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})}return o},createButtonLabel:function(e,t){var o="";return t+e>1?o=this.intlMessage({intlName:"album-page.DOWNLOAD_ZIP"}):1===e&&0===t?o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e}):0===e&&1===t&&(o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})),o},prepareArchive:function(e){var t=this;return this.appContext.callAPI("flickr.download.archives.create",e).then(function(e){var o,n,i=e.archive.countPhotos,a=e.archive.countVideos,l=[],s=e.archive.key;return o=t.createTitle(i,a),n=t.createButtonLabel(i,a),l=e.archive.urls.map(function(e,t){return{url:e,partSequence:t+1}}),{title:o,downloadURLs:l,buttonLabel:n,key:s}}).catch(function(e){throw 105===e.code?new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})):new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"}))})},showDownloadDialog:function(o){var n,i,a=o.title,l=this,s=o.downloadURLs||[];return this.doOffline&&((n=o.setID?{set_id:o.setID}:o.share_code?{share_code:o.share_code,gp_code:o.gp_code,gp_owner:o.gp_owner}:{photo_ids:o.photoIDs,owner_id:o.ownerID}).extras="offline_enabled"),i=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!this.doOffline,showCancelButton:!!this.doOffline,showFooter:!!this.doOffline,showActionButton:!!this.doOffline,actionButtonLabel:this.doOffline?this.intlMessage({intlName:"downloadr.CREATE_ZIP"}):"",title:a,message:this.templates("bulk-download-modal")({isMany:s.length>1,downloadURLs:s,buttonLabel:o.buttonLabel,isOwnAlbum:this.get("isOwnAlbum"),doOffline:this.doOffline,loggedOut:!this.appContext.getViewer().signedIn}),classList:"bulk-download-dialog"}).show(),l.doOffline?(i.on("actionClick",function(o){o.preventDefault(),e.rapidTracker.beacon(t,"completeArchiveDownloadClick"),i.get("container").one(".copyright").setHTML(l.templates("flickr-balls")({})),l.prepareArchive(n).then(function(e){i.close(),l.appContext.getViewer().signedIn?l.showTooltip(e.key):l.appContext.flapp.navigate("/download/"+e.key)}).catch(function(t){105===t.code?l.onError(new Error(l.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})),i):(e.config.win.beaconError("[bulk-download] Error creating archive ",e.config.win.location.href,t),l.onError(new Error(l.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"})),i))})}),i.on("cancelClick",function(o){o.preventDefault(),e.rapidTracker.beacon(t,"archiveCancelClick"),i.close()})):i.on("activated",function(){i.get("container").all(".butt").on("click",function(o){1===s.length?(e.rapidTracker.beacon(t,"completeArchiveDownloadClick"),i.close()):(e.rapidTracker.beacon(t,"partialArchiveDownloadClick"),o.target.addClass("is-disabled"))})}),i},onError:function(t,o){o&&o.close(),new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t.message,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},showTooltip:function(t){var o=e.one(".global-nav-view").one(".notifications-menu-view"),n=this;if(o){this.tooltip=new e.Views.FluidDroparound({appContext:this.appContext,htmlMessage:this.templates("download-tooltip")({content:this.intlHTMLMessage({intlName:"downloadr.TOOLTIP_DOWNLOAD_LINK_MESSAGE",url:"/download/"+t}),confirmationLink:this.intlMessage({intlName:"downloadr.TOOLTIP_OK"})}),showDropArrow:!0,dismissOnOverlayClick:!0,observePageResize:!0,anchorElement:o,keyboardAnchorElement:o,minVerticalSpace:400,width:350,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetHorizontal:11,anchorOffsetVertical:0});var i=this.tooltip.get("container");n.registerEventHandler(i.delegate("click",function(e){e.preventDefault(),n.tooltip.close()},".close-onboarding")),this.tooltip.show()}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-bulk-download-modal","hermes-template-download-tooltip","hermes-template-flickr-balls"],langBundles:["common","downloadr","album-page","cameraroll"],optional:[],affinity:"client"});
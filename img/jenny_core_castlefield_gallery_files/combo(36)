YUI.add("hermes-template-album-page",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,l,n){var u=null!=t?t:{},o=a.helperMissing,r=e.escapeExpression;return r((a.outlet||t&&t.outlet||o).call(u,null!=t?t["global-nav-view"]:t,{name:"outlet",hash:{},data:n}))+'\n\n<div role="main" class="album-container fluid-centered">\n\t'+r((a.outlet||t&&t.outlet||o).call(u,null!=t?t["album-toolbar-view"]:t,{name:"outlet",hash:{},data:n}))+"\n\t"+r((a.outlet||t&&t.outlet||o).call(u,null!=t?t["album-header-view"]:t,{name:"outlet",hash:{},data:n}))+"\n\t"+r((a.outlet||t&&t.outlet||o).call(u,null!=t?t["photo-list-view"]:t,{name:"outlet",hash:{},data:n}))+"\n\t"+r((a.outlet||t&&t.outlet||o).call(u,null!=t?t["pagination-view"]:t,{name:"outlet",hash:{},data:n}))+"\n\n</div>\n"+r((a.outlet||t&&t.outlet||o).call(u,null!=t?t["signup-footer-view"]:t,{name:"outlet",hash:{},data:n}))+"\n"+r((a.outlet||t&&t.outlet||o).call(u,null!=t?t["footer-full-view"]:t,{name:"outlet",hash:{},data:n}))},useData:!0}),l={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(l[t]=a)}),e.Template.register("hermes/album-page",function(t,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,a(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-album-toolbar",function(a,t){var e=a.Template.Handlebars.revive({1:function(a,t,e,l,n){var s,i=null!=t?t:{},o=e.helperMissing,r=a.escapeExpression;return'\t\t<a class="edit-in-organizr" href="/photos/organize/?start_tab=one_set'+r("function"==typeof(s=null!=(s=e.setId||(null!=t?t.setId:t))?s:o)?s.call(i,{name:"setId",hash:{},data:n}):s)+'">'+r((e.intlMessage||t&&t.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"album-page.EDIT_IN_ORGANIZR"},data:n}))+"</a>\n"},3:function(a,t,e,l,n){return" selected"},compiler:[7,">= 4.0.0"],main:function(a,t,e,l,n){var s,i,o=null!=t?t:{},r=e.helperMissing,u=a.escapeExpression;return'<div class="album-toolbar-content">\n\t<a class="back-to-albums" href="/photos/'+u("function"==typeof(i=null!=(i=e.nsidOrPathAlias||(null!=t?t.nsidOrPathAlias:t))?i:r)?i.call(o,{name:"nsidOrPathAlias",hash:{},data:n}):i)+"/albums/with/"+u("function"==typeof(i=null!=(i=e.setId||(null!=t?t.setId:t))?i:r)?i.call(o,{name:"setId",hash:{},data:n}):i)+'">\n\t\t<svg class="icon icon-back"><use xlink:href="#icon-back"></use></svg>\n\t\t<span class="back-to-albums-text">\n\t\t\t'+u((e.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"album-page.BACK_TO_ALBUMS"},data:n}))+"\n\t\t</span>\n\t</a>\n"+(null!=(s=e.if.call(o,null!=t?t.viewerIsOwner:t,{name:"if",hash:{},fn:a.program(1,n,0),inverse:a.noop,data:n}))?s:"")+"\t"+u((e.outlet||t&&t.outlet||r).call(o,null!=t?t["fluid-magic-slideshow-view"]:t,{name:"outlet",hash:{},data:n}))+'\n\t<button data-layout="justified" class="layout justified'+(null!=(s=e.if.call(o,null!=t?t.isJustifiedLayout:t,{name:"if",hash:{},fn:a.program(3,n,0),inverse:a.noop,data:n}))?s:"")+'" title="'+u((e.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"common.JUSTIFIED_VIEW"},data:n}))+'"></button>\n\t<button data-layout="story" class="layout story'+(null!=(s=e.if.call(o,null!=t?t.isStoryLayout:t,{name:"if",hash:{},fn:a.program(3,n,0),inverse:a.noop,data:n}))?s:"")+'" title="'+u((e.intlMessage||t&&t.intlMessage||r).call(o,{name:"intlMessage",hash:{intlName:"common.LARGE_VIEW"},data:n}))+'"></button>\n</div>\n'},useData:!0}),l={};a.Array.each([],function(t){var e=a.Template.get("hermes/"+t);e&&(l[t]=e)}),a.Template.register("hermes/album-toolbar",function(t,n){return n=n||{},n.partials=n.partials?a.merge(l,n.partials):l,e(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("album-toolbar-view",function(t){t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"fluid-magic-slideshow-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},initializer:function(t){return this.albumId=t.albumId,this.albumPhotoListLayoutStyle=t.albumPhotoListLayoutStyle,this.nsidOrPathAlias=t.nsidOrPathAlias,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return t.appContext.getModel("set-models",t.albumId).then(function(e){t.set("albumModel",e)})},buildContainer:function(){var t=this.get("albumModel"),e=t.id,i=!1;return this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===t.getValue("owner").id&&(i=!0),this.setContainerWithTemplate("album-toolbar",{nsidOrPathAlias:this.nsidOrPathAlias,viewerIsOwner:i,setId:e,isJustifiedLayout:"justified"===this.albumPhotoListLayoutStyle,isStoryLayout:"story"===this.albumPhotoListLayoutStyle}),this},buildErrorContainer:function(){},activate:function(){var e=this.get("container"),i=this;return this.registerEventHandler(e.all(".layout").on("click",function(a){a.preventDefault();var l=a.target.getAttribute("data-layout");l!==i.layoutStyle&&(e.one(".selected").removeClass("selected"),a.target.addClass("selected"),t.fire("albumToolbarView:layoutChange",l),i.layoutStyle=l)})),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-toolbar","fluid-magic-slideshow-view"],optional:[],langBundles:["album-page","common"]});YUI.add("hermes-template-album-header",function(e,a){var t=e.Template.Handlebars.revive({1:function(e,a,t,l,n){var s,i=null!=a?a:{},r=t.helperMissing;return'\t\t<span class="edit-cover-photo" title="'+e.escapeExpression((t.intlMessage||a&&a.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"album-page.EDIT_COVER"},data:n}))+'">\n\t\t\t<i></i>\n\t\t</span>\n'+(null!=(s=(t.isFlipped||a&&a.isFlipped||r).call(i,"enable-change-album-sorting",{name:"isFlipped",hash:{},fn:e.program(2,n,0),inverse:e.noop,data:n}))?s:"")},2:function(e,a,t,l,n){return'\t\t\t<span class="change-album-sorting">\n\t\t\t\t'+e.escapeExpression((t.intlMessage||a&&a.intlMessage||t.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"album-page.SORT"},data:n}))+"<i></i>\n\t\t\t</span>\n"},compiler:[7,">= 4.0.0"],main:function(e,a,t,l,n){var s,i,r=null!=a?a:{},u=t.helperMissing,o=e.escapeExpression;return'<div class="album-header-content" style="height: '+o("function"==typeof(i=null!=(i=t.height||(null!=a?a.height:a))?i:u)?i.call(r,{name:"height",hash:{},data:n}):i)+"px; background-image: url("+o("function"==typeof(i=null!=(i=t["cover-photo-url"]||(null!=a?a["cover-photo-url"]:a))?i:u)?i.call(r,{name:"cover-photo-url",hash:{},data:n}):i)+');">\n\n\t<div class="dimming-shim"></div>\n\t<div class="flex-padding"></div>\n\n'+(null!=(s=t.if.call(r,null!=a?a.viewerIsOwner:a,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?s:"")+"\n\t"+o((t.outlet||a&&a.outlet||u).call(r,null!=a?a["album-title-desc-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t"+o((t.outlet||a&&a.outlet||u).call(r,null!=a?a["album-stats-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t"+o((t.outlet||a&&a.outlet||u).call(r,null!=a?a["album-engagement-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\t<div class="flex-padding"></div>\n\n\t'+o((t.outlet||a&&a.outlet||u).call(r,null!=a?a["attribution-view"]:a,{name:"outlet",hash:{},data:n}))+"\n</div>\n"},useData:!0}),l={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)}),e.Template.register("hermes/album-header",function(a,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,t(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-album-title-desc",function(e,n){var a=e.Template.Handlebars.revive({1:function(e,n,a,t,l){return"editable"},3:function(e,n,a,t,l){return'\t\t<span class="title-desc-edit" data-action="edit" title="'+e.escapeExpression((a.intlMessage||n&&n.intlMessage||a.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"common.EDIT"},data:l}))+'"></span>\n'},5:function(e,n,a,t,l){return"description-placeholder"},7:function(e,n,a,t,l){return"\t\t\t"+e.escapeExpression((a.renderTrustedMarkup||n&&n.renderTrustedMarkup||a.helperMissing).call(null!=n?n:{},null!=n?n.description:n,{name:"renderTrustedMarkup",hash:{},data:l}))+"\n"},9:function(e,n,a,t,l){var i;return null!=(i=a.if.call(null!=n?n:{},null!=n?n.canEdit:n,{name:"if",hash:{},fn:e.program(10,l,0),inverse:e.noop,data:l}))?i:""},10:function(e,n,a,t,l){return"\t\t\t\t"+e.escapeExpression((a.intlMessage||n&&n.intlMessage||a.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"album-page.ALBUM_ADD_DESCRIPTION"},data:l}))+"\n"},12:function(e,n,a,t,l){return'\t<button class="done-editing-album-title-desc hidden" data-action="saveAlbumTitleDescEdit">'+e.escapeExpression((a.intlMessage||n&&n.intlMessage||a.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"common.DONE"},data:l}))+"</button>\n"},compiler:[7,">= 4.0.0"],main:function(e,n,a,t,l){var i,s,r=null!=n?n:{},d=a.helperMissing,o=e.escapeExpression;return'<div class="title-desc-block '+(null!=(i=a.if.call(r,null!=n?n.canEdit:n,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?i:"")+'">\n\t<div class="'+(null!=(i=a.if.call(r,null!=n?n.canEdit:n,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?i:"")+' album-title">\n\t\t'+o("function"==typeof(s=null!=(s=a.title||(null!=n?n.title:n))?s:d)?s.call(r,{name:"title",hash:{},data:l}):s)+"\n\t</div>\n\n"+(null!=(i=a.if.call(r,null!=n?n.canEdit:n,{name:"if",hash:{},fn:e.program(3,l,0),inverse:e.noop,data:l}))?i:"")+'\n\t<input type="text" class="meta-field edit-meta-field edit-album-title" wrap="on"></input>\n\n\t<div class="'+(null!=(i=a.if.call(r,null!=n?n.canEdit:n,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?i:"")+" album-desc "+(null!=(i=a.unless.call(r,null!=n?n.description:n,{name:"unless",hash:{},fn:e.program(5,l,0),inverse:e.noop,data:l}))?i:"")+'">\n'+(null!=(i=a.if.call(r,null!=n?n.description:n,{name:"if",hash:{},fn:e.program(7,l,0),inverse:e.program(9,l,0),data:l}))?i:"")+'\t</div>\n\n\t<div class="description-show-more hidden">\n\t\t<span class="description-show-more-link '+(null!=(i=a.if.call(r,null!=n?n.canEdit:n,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?i:"")+'" data-action="showMore">\n\t\t\t'+o((a.intlMessage||n&&n.intlMessage||d).call(r,{name:"intlMessage",hash:{intlName:"common.SHOW_MORE"},data:l}))+'\n\t\t</span>\n\t</div>\n\n\t<textarea class="meta-field edit-meta-field edit-album-desc" wrap="on"></textarea>\n</div>\n\n'+(null!=(i=a.if.call(r,null!=n?n.canEdit:n,{name:"if",hash:{},fn:e.program(12,l,0),inverse:e.noop,data:l}))?i:"")},useData:!0}),t={};e.Array.each([],function(n){var a=e.Template.get("hermes/"+n);a&&(t[n]=a)}),e.Template.register("hermes/album-title-desc",function(n,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,a(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("album-title-desc-view",function(e){var t={bigFont:"26px",smallFont:"18px",heightOfOneLineOfTextUsingBigFont:29,maxNumberOfLinesOfDescriptionToShow:2,maxNumberOfLinesOfDescriptionToShowJustified:1,maxNumberOfLinesOfDescriptionToShowInEditField:4,currentDescriptionEditableFieldHeight:29,heightOfOneLineOfTextWhenJustified:29};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var e=this;return e.appContext.getModel("set-models",e.albumId).then(function(t){e.set("albumModel",t)})},wrapDescription:function(e){return e=e.split("\n"),e.length>1&&e.forEach(function(e,t,i){i[t]=e+"<br>"}),e.join("")},doneEditingTitleDescription:function(){var i,s,a=this,n=this.get("albumModel"),o=a.intlMessage({intlName:"album-page.ALBUM_ADD_DESCRIPTION"}),l=n.getValue("title").trim(),d=n.getValue("description").trim(),r=this.get("container"),c=r.one(".album-desc"),h=r.one(".album-title"),u=r.one(".edit-album-desc"),m=r.one(".edit-album-title"),g=r.one(".done-editing-album-title-desc");r.removeClass("editing"),""===(i=m.get("value").trim())&&(i=l),s=u.get("value")!==o?u.get("value").trim():"",g.addClass("hidden"),a.fire("subviewViewEvent","albumTitleDesc:doneEditing"),i!==l||s!==d?(n.setValue("title",i),n.setValue("description",s),e.rapidTracker.beacon(a.name,"albumTitleDescriptionSave"),n.remoteUpdate().then(function(){var e=n.getValue("title"),i=n.getValue("description");h.set("text",e),""!==i.trim()?(c.removeClass("description-placeholder"),i=a.wrapDescription(i),c.setHTML(i)):(c.addClass("description-placeholder"),c.setHTML(o)),m.removeClass("show-editable"),u.removeClass("show-editable"),h.removeClass("hidden"),c.removeClass("hidden"),r.hasClass("justified")?a.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShowJustified):a.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShow)},function(e){n.setValue("title",l),n.setValue("description",d),h.set("text",l),""!==d.trim()?(c.removeClass("description-placeholder"),c.setHTML(d)):(c.addClass("description-placeholder"),c.setHTML(o)),m.removeClass("show-editable"),u.removeClass("show-editable"),h.removeClass("hidden"),c.removeClass("hidden"),r.hasClass("justified")?a.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShowJustified):a.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShow),a.onError(a.intlMessage({intlName:"album-page.ERROR_UPDATING_ALBUM_TITLE_DESCRIPTION"}))})):(m.removeClass("show-editable"),u.removeClass("show-editable"),h.removeClass("hidden"),""===s.trim()?(c.addClass("description-placeholder"),c.setHTML(o)):(s=a.wrapDescription(s),c.removeClass("description-placeholder"),c.setHTML(s)),c.removeClass("hidden"),r.hasClass("justified")?a.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShowJustified):a.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShow)),r.hasClass("justified")&&t.currentDescriptionEditableFieldHeight!==t.heightOfOneLineOfTextWhenJustified&&(a.fire("subviewViewEvent","albumTitleDescEditing:heightChange",t.heightOfOneLineOfTextWhenJustified-t.currentDescriptionEditableFieldHeight),t.currentDescriptionEditableFieldHeight=t.heightOfOneLineOfTextWhenJustified)},editTitleDescription:function(t){var i,s,a=this.get("container"),n=this.intlMessage({intlName:"album-page.ALBUM_ADD_DESCRIPTION"}),o=a.one(".album-title"),l=a.one(".edit-album-desc"),d=a.one(".edit-album-title"),r=this.get("albumModel"),c=r.getValue("title"),h=r.getValue("description").trim(),u=a.one(".description-show-more"),m=a.one(".done-editing-album-title-desc");(t.target.hasClass("editable album-title")||t.target.hasClass("editable album-desc")||t.target.ancestor().hasClass("editable album-desc")||t.target.hasClass("title-desc-edit")||t.target.hasClass("description-show-more-link editable")||t.target.hasClass("title-desc-block editable"))&&"a"!==t.target.get("tagName").toLowerCase()&&(t.preventDefault(),t.stopPropagation(),a.addClass("editing"),u.addClass("hidden"),this.fire("subviewViewEvent","albumTitleDesc:editing"),m.removeClass("hidden"),i=o.getXY(),d.set("value",c),d.setStyle("height",o.get("offsetHeight")),d.setStyle("width",o.get("offsetWidth")),d.setStyle("left",i[0]),d.setStyle("top",i[1]),o.addClass("hidden"),d.addClass("show-editable"),h?(s=h.replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<"),l.removeClass("description-placeholder")):(s=n,l.addClass("description-placeholder")),l.set("value",s),this.makeDescriptionEditFieldResponsive(),t.target.hasClass("editable album-title")?d.focus():l.focus(),e.rapidTracker.beacon(this.name,"albumTitleDescriptionEdit"))},makeDescriptionEditFieldResponsive:function(){var e,i,s,a,n,o=this.get("container"),l=o.one(".album-desc"),d=o.one(".edit-album-desc"),r=d.get("value"),c=!1;o.hasClass("justified")&&(c=!0),r?(r=r.replace(/"/g,"&quot;").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=this.wrapDescription(r),l.addClass("calculating").removeClass("hidden"),l.setHTML(r),(i=parseInt(l.getComputedStyle("height"),10))>t.heightOfOneLineOfTextUsingBigFont*t.maxNumberOfLinesOfDescriptionToShowInEditField?d.setStyle("height",t.heightOfOneLineOfTextUsingBigFont*t.maxNumberOfLinesOfDescriptionToShowInEditField):d.setStyle("height",i),c&&(n=parseInt(d.getComputedStyle("height"),10))!==t.currentDescriptionEditableFieldHeight&&(e=n-t.currentDescriptionEditableFieldHeight,this.fire("subviewViewEvent","albumTitleDescEditing:heightChange",e),t.currentDescriptionEditableFieldHeight=n),s=l.get("offsetWidth"),a=l.getXY(),d.setStyle("width",s),d.setStyle("left",a[0]),d.setStyle("top",a[1]),l.addClass("hidden").removeClass("calculating"),d.addClass("show-editable")):(d.setStyle("height",t.heightOfOneLineOfTextUsingBigFont),l.addClass("hidden").removeClass("calculating"))},displayShowMoreIfNeeded:function(e){var i,s=this.get("container"),a=s.one(".album-desc"),n=s.one(".title-desc-block"),o=s.one(".description-show-more");a&&((i=a.cloneNode(!0)).removeClass("album-desc"),i.addClass("album-desc-calculator"),n.append(i),parseInt(i.getComputedStyle("height"),10)>t.heightOfOneLineOfTextUsingBigFont*e?o.removeClass("hidden"):o.addClass("hidden"),i.remove(!0))},showMoreClick:function(t){var i=this.get("albumModel").getValue("description"),s=this.get("container").one(".description-show-more");i=this.wrapDescription(i),t.target.hasClass("editable")?(s.addClass("hidden"),this.editTitleDescription(t)):new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"album-page.ALBUM_DESCRIPTION"}),message:i,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1,classList:"album-full-description"}).show()},buildContainer:function(){var e=this.get("albumModel"),t=e.getValue("title"),i=e.getValue("description"),s=e.getValue("isAutoUploadSet"),a=!1,n=!1,o=this.get("container");return""!==i.trim()&&(n=!0,"justified"===this.albumPhotoListLayoutStyle&&o.addClass("justified"),i=this.wrapDescription(i)),this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===e.getValue("owner").id&&!s&&(a=!0),this.setContainerWithTemplate("album-title-desc",{title:t,description:i,hasDescription:n,canEdit:a}),this},buildErrorContainer:function(){},activate:function(){var i=this,s=this.get("albumModel"),a=this.get("container"),n=i.intlMessage({intlName:"album-page.ALBUM_ADD_DESCRIPTION"}),o=a.one(".title-desc-block"),l=a.one(".edit-album-title"),d=a.one(".edit-album-desc"),r=a.one(".title-desc-edit"),c=a.one(".description-show-more-link"),h=!1;return this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===s.getValue("owner").id&&(h=!0),a.hasClass("justified")?i.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShowJustified):i.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShow),h&&!s.getValue("isAutoUploadSet")&&(i.registerEventHandler(o.on("click",function(e){i.editTitleDescription(e)},o)),i.registerEventHandler(r.on("click",function(e){i.editTitleDescription(e)},r))),i.registerEventHandler(c.on("click",function(e){i.showMoreClick(e)},c)),this.registerEventHandler(l.on("keyup",function(e){13===e.keyCode&&i.doneEditingTitleDescription()},this)),this.registerEventHandler(l.on("blur",function(t){setTimeout(function(){try{e.config.doc.activeElement.isEqualNode(l.getDOMNode())||e.config.doc.activeElement.classList.contains("edit-album-desc")||i.doneEditingTitleDescription()}catch(e){}},1,l)},this)),this.registerEventHandler(d.on("keyup",function(e){i.makeDescriptionEditFieldResponsive()},this)),this.registerEventHandler(d.on("blur",function(t){""===d.get("value").trim()?(d.addClass("description-placeholder"),d.set("value",n)):d.removeClass("description-placeholder"),setTimeout(function(){try{e.config.doc.activeElement.isEqualNode(d.getDOMNode())||e.config.doc.activeElement.classList.contains("edit-album-title")||i.doneEditingTitleDescription()}catch(e){}},1,d)},this)),this.registerEventHandler(d.on("focus",function(){d.get("value").trim()===n&&(d.removeClass("description-placeholder"),d.set("value",""))},this)),e.on("albumToolbarView:layoutChange",function(e){"justified"===e?(a.addClass("justified"),i.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShowJustified)):(a.removeClass("justified"),i.displayShowMoreIfNeeded(t.maxNumberOfLinesOfDescriptionToShow))}),this},onError:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,darkOverlay:!0}),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-title-desc","handlebars-helpers"],optional:[],langBundles:["common","album-page"]});YUI.add("hermes-template-album-stats",function(e,a){var s=e.Template.Handlebars.revive({1:function(e,a,s,n,t){return'\t\t<span class="photo-counts">'+e.escapeExpression((s.intlMessage||a&&a.intlMessage||s.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{selectedCount:null!=a?a.photosArePresent:a,intlName:"album-page.PHOTOS_COUNT"},data:t}))+"</span>\n"},3:function(e,a,s,n,t){var l,r=null!=a?a:{};return(null!=(l=s.if.call(r,null!=a?a.photosArePresent:a,{name:"if",hash:{},fn:e.program(4,t,0),inverse:e.noop,data:t}))?l:"")+'\t\t<span class="video-counts">'+e.escapeExpression((s.intlMessage||a&&a.intlMessage||s.helperMissing).call(r,{name:"intlMessage",hash:{selectedCount:null!=a?a.videosArePresent:a,intlName:"album-page.VIDEOS_COUNT"},data:t}))+"</span>\n"},4:function(e,a,s,n,t){return'\t\t\t<span class="album-stats-separator">&middot;</span>\n'},6:function(e,a,s,n,t){return'\t\t<span class="album-stats-separator">&middot;</span>\n\t\t<span class="view-counts">'+e.escapeExpression((s.intlMessage||a&&a.intlMessage||s.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{selectedCount:null!=a?a.viewsArePresent:a,intlName:"album-page.VIEWS_COUNT"},data:t}))+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(e,a,s,n,t){var l,r=null!=a?a:{};return'<div class="stats-container">\n'+(null!=(l=s.if.call(r,null!=a?a.photosArePresent:a,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t}))?l:"")+(null!=(l=s.if.call(r,null!=a?a.videosArePresent:a,{name:"if",hash:{},fn:e.program(3,t,0),inverse:e.noop,data:t}))?l:"")+(null!=(l=s.if.call(r,null!=a?a.viewsArePresent:a,{name:"if",hash:{},fn:e.program(6,t,0),inverse:e.noop,data:t}))?l:"")+"</div>\n"},useData:!0}),n={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(n[a]=s)}),e.Template.register("hermes/album-stats",function(a,t){return t=t||{},t.partials=t.partials?e.merge(n,t.partials):n,s(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("album-stats-view",function(t){t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.albumId=t.albumId,this.albumPhotoListLayoutStyle=t.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return t.appContext.getModel("set-models",t.albumId).then(function(e){t.set("albumModel",e)})},buildContainer:function(){var t=this.get("albumModel"),e=t.getValue("photoCount"),i=t.getValue("videoCount"),n=t.getValue("viewCount"),a=this.get("container");return"justified"===this.albumPhotoListLayoutStyle&&a.addClass("justified"),this.setContainerWithTemplate("album-stats",{photosArePresent:e,videosArePresent:i,viewsArePresent:n}),this},buildErrorContainer:function(){},activate:function(){return this},onParentViewEvent:function(t,e){var i=this.get("container");return"album-stats-view"===t&&"albumHeaderView:editing"===e[0]?(i.addClass("invisible"),!1):"album-stats-view"===t&&"albumHeaderView:doneEditing"===e[0]?(i.removeClass("invisible"),!1):void 0}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-stats"],optional:[],langBundles:["common","album-page"]});YUI.add("hermes-template-album-engagement",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,l,t){return'\t<div class="create-book-container">\n\t\t<span class="create-book-icon" title="'+e.escapeExpression((n.intlMessage||a&&a.intlMessage||n.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"album-page.CREATE_BOOK_FROM_ALBUM"},data:t}))+'"></span>\n\t</div>\n'},3:function(e,a,n,l,t){return'\t<div class="download-album-container">\n\t\t<span class="download-album-icon"></span>\n\t</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,a,n,l,t){var s,r=null!=a?a:{};return e.escapeExpression((n.outlet||a&&a.outlet||n.helperMissing).call(r,null!=a?a["fluid-share-album-view"]:a,{name:"outlet",hash:{},data:t}))+"\n\n"+(null!=(s=n.if.call(r,null!=a?a.viewerIsOwner:a,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t}))?s:"")+"\n\n"+(null!=(s=n.if.call(r,null!=a?a.enableDownload:a,{name:"if",hash:{},fn:e.program(3,t,0),inverse:e.noop,data:t}))?s:"")},useData:!0}),l={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(l[a]=n)}),e.Template.register("hermes/album-engagement",function(a,t){return t=t||{},t.partials=t.partials?e.merge(l,t.partials):l,n(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("album-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.doOffline=!!this.appContext.flipper.isFlipped("enable-offline-downloadr"),this},subviewConfig:{"fluid-share-album-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,parentViewName:this.name}},loadState:function(){var e=this;return e.appContext.getModel("set-models",e.albumId).then(function(t){e.set("albumModel",t)})},createBookFromAlbum:function(){var t=this;this.appContext.flipper.isFlipped("enable-blurb-photobooks-links")?this.appContext.flapp.navigate("/create"):t.appContext.getModelRegistry("book-models").then(function(i){return i.remoteCreate({photoset_id:t.albumId}).then(function(i){e.rapidTracker.beacon(t.name,"photobookFromAlbum"),t.appContext.flapp.navigate("/create/books/"+i.id+"/cover")})},function(e){t.onError(t.intlMessage({intlName:"album-page.ERROR_CREATING_PHOTOBOOK_FROM_ALBUM"}))})},buildContainer:function(){var e=this.get("container"),t=this.get("albumModel"),i=!1,o={};return"justified"===this.albumPhotoListLayoutStyle&&e.addClass("justified"),this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===t.getValue("owner").id&&(i=!0),o.viewerIsOwner=i,o.enableDownload=!1,(this.appContext.flipper.isFlipped("enable-just-your-album-download")&&i||this.appContext.flipper.isFlipped("enable-album-download")&&t.getValue("canDownload"))&&(o.enableDownload=!0),this.subviews["fluid-share-album-view"]&&(o["fluid-share-album-view"]=this.subviews["fluid-share-album-view"].get("container"),(o.viewerIsOwner||o["enable-download"])&&o["fluid-share-album-view"].addClass("not-alone")),this.setContainerWithTemplate("album-engagement",o),this},buildErrorContainer:function(){},activate:function(){var t=this,i=this.get("container"),o=i.one(".create-book-container"),n=i.one(".download-album-container");return o&&t.registerEventHandler(o.on("click",function(){t.createBookFromAlbum()})),n&&(this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext,doOffline:this.doOffline}),t.registerEventHandler(n.on("click",t.downloadAlbum.bind(this)))),this},destructor:function(){this.bulkDownloaderView&&this.bulkDownloaderView.destroy()},downloadAlbum:function(t){var i,o,n=this,a=this.get("albumModel");if(e.rapidTracker.beacon(this.name,"openDownloadAlbum"),this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===a.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),this.doOffline){if(1===a.getValue("totalCount"))return a.getValue("photoPageList").getPage({page:1,perPage:1}).then(function(t){var i,o,n,a=t[0];a.getValue("isVideo")?o="/video_download.gne?id="+a.id:(i=(n=a.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),o="https:"+n.join(".")+"_d."+i),e.config.doc.location.href=o});if(a.getValue("totalCount")>e.config.flickr.downloadr.max_album_items)return e.rapidTracker.beacon(this.name,"albumDownloadTooMany"),this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:a.getValue("owner").getValue("displayname"),userurl:a.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+a.id}),this.intlMessage({intlName:"downloadr.TOO_MANY_TITLE"}),!0);i=n.bulkDownloaderView.createTitle(a.getValue("photoCount"),a.getValue("videoCount")),n.bulkDownloaderView.showDownloadDialog({doOffline:!0,title:i,setID:this.albumId})}else o=this.bulkDownloaderView.showLoadingDialog(),this.bulkDownloaderView.prepareArchive({set_id:this.albumId}).then(function(e){o.close(),n.bulkDownloaderView.showDownloadDialog(e)}).catch(function(e){o.close(),n.onError(e)})},onParentViewEvent:function(e,t){var i=this.get("container");return"album-engagement-view"===e&&"albumHeaderView:editing"===t[0]?(i.addClass("invisible"),!1):"album-engagement-view"===e&&"albumHeaderView:doneEditing"===t[0]?(i.removeClass("invisible"),!1):void 0},onError:function(t,i,o){var n;return n={appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),darkOverlay:!0},n[o?"htmlMessage":"message"]=t,this.errorDialog=new e.Views.FluidModal(n),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-engagement","hermes-template-flickr-balls"],optionalRequires:["bulk-downloader-view"],optional:["fluid-share-album-view"],langBundles:["common","album-page","downloadr"]});YUI.add("album-header-view",function(e,t){var i=require("hermes-core/flog")(t),a={css:{headerContent:".album-header-content"}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"album-title-desc-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-stats-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,hideFollowView:!0,additionalViewClasses:["album-attribution"],isAlbumView:!0}},loadState:function(){var t=this,i=[];return i.push(this.appContext.getModel("set-models",this.albumId)),this.appContext.getViewer().signedIn&&i.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid)),e.Promise.all(i).then(function(e){t.set("albumModel",e[0]),e[1]&&t.set("personPreferenceModel",e[1])})},buildContainer:function(){var e,t=this.get("container"),a=this.getAlbumHeaderHeight()-60,n=this.get("albumModel"),o=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===n.getValue("owner").id,s=this.appContext.viewportData.getDevicePixelRatio();return"justified"===this.albumPhotoListLayoutStyle&&(t.addClass("justified-transitions"),t.addClass("justified"),a=300),(e=n.registry.getSizeToFit(this.albumId,{width:.8*this.appContext.viewportData.getWidth()*s,height:a*s}))||i.error("Failed to load album coverphoto."),this.setContainerWithTemplate("album-header",{height:a,"cover-photo-url":e?e.url:"",viewerIsOwner:o}),this},buildErrorContainer:function(){},activate:function(){var t,i=this,n=this.get("container"),o=n.one(".edit-cover-photo"),s=n.one(".album-header-content"),l=n.one(".avatar"),r=this.get("personPreferenceModel");if(this.albumHeaderElement=this.get("container").one(a.css.headerContent),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.resizeHeader.bind(this))),o&&this.registerEventHandler(o.on("click",this.handleSetCoverPhotoClick.bind(this))),this.appContext.flipper.isFlipped("enable-change-album-sorting")){var d=this.get("container").one(".change-album-sorting");d&&this.registerEventHandler(d.on("click",this.handleChangeAlbumSorting.bind(this)))}e.on("albumToolbarView:layoutChange",function(a){r&&(r.setValues({albumViewLayoutPref:a}),r.remoteUpdate()),"justified"===a?(n.addClass("justified-transitions"),n.addClass("justified"),s.setStyle("height",300),l&&e.flutil.onTransitionEnd(l,function(){n.one(".album-attribution").addClass("justified-album-details-page")})):(t=i.getAlbumHeaderHeight()-60+"px",s.setStyle("height",t),n.removeClass("justified"),l&&setTimeout(function(){n.one(".album-attribution").removeClass("justified-album-details-page")},250),e.flutil.onTransitionEnd(s,function(){n.removeClass("justified-transitions")}))})},onSubviewEvent:function(e,t){var i=this.get("container"),a=i.one(".album-header-content"),n=i.one(".edit-cover-photo");return"album-title-desc-view"===e&&"albumTitleDesc:editing"===t[0]?(this.fire("parentViewEvent","albumHeaderView:editing"),n.addClass("hidden"),!1):"album-title-desc-view"===e&&"albumTitleDesc:doneEditing"===t[0]?(this.fire("parentViewEvent","albumHeaderView:doneEditing"),n.removeClass("hidden"),!1):void("album-title-desc-view"===e&&"albumTitleDescEditing:heightChange"===t[0]&&t[1]&&a.setStyle("height",parseInt(a.getComputedStyle("height"),10)+t[1]+"px"))},resizeHeader:function(e){var t=this.getAlbumHeaderHeight()-60;this.get("container").hasClass("justified")||this.albumHeaderElement.setStyle("height",t)},getAlbumHeaderHeight:function(){var e,t=this.appContext.viewportData.getWidth(),i=this.appContext.viewportData.getHeight()-50,a=t/2.3+120,n=t/2.75;return e=i>t/1.3+120?t/1.3:i>a?i-120:i>n?i-120+120*(i-a)/(n-a):i,Math.max(480,Math.round(e))},handleChangeAlbumSorting:function(t){if(this.appContext.flipper.isFlipped("enable-change-album-sorting")){t.halt();var i=this;this.sortingOptionsDialog=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target,minVerticalSpace:250,positionFixed:!0,anchorOffsetHorizontal:14,menuItems:[{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_NEWEST"}),value:"date-posted-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_TAKEN_OLDEST"}),value:"date-posted-desc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_OLDEST"}),value:"date-taken-asc"},{text:this.intlMessage({intlName:"album-page.SORT_DATE_UPLOADED_NEWEST"}),value:"date-taken-desc"},{text:this.intlMessage({intlName:"album-page.SORT_ALPHABETICALLY"}),value:"title"},{text:this.intlMessage({intlName:"album-page.SORT_RANDOMLY"}),value:"random"},{text:this.intlMessage({intlName:"album-page.SORT_REVERSE"}),value:"reverse"}]}),this.registerEventHandler(this.sortingOptionsDialog.on("selected",function(t){if(t.preventDefault(),i.sortingOptionsDialog.close(),t.menuItem&&t.menuItem.value){var a={photoset_id:i.get("albumModel").getValue("id"),sort:t.menuItem.value,preview:0};i.loadingModal=new e.Views.FluidModal({appContext:this.appContext,title:i.intlMessage({intlName:"common.LOADING"}),message:i.intlMessage({intlName:"album-page.SORT_ALMOST_DONE"}),showButtons:!1}),i.loadingModal.show(),i.appContext.callAPI("flickr.photosets.sortPhotos",a).then(i.onAlbumSortingChanged.bind(i)).catch(i.onAlbumSortingFailed.bind(i))}})),this.sortingOptionsDialog.show()}},onAlbumSortingChanged:function(t){"ok"===t.stat?e.config.win.location.reload():this.onAlbumSortingFailed(t)},onAlbumSortingFailed:function(t){if("fail"===t.stat){new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:"Error while changing sort",actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()}},handleSetCoverPhotoClick:function(t){t.preventDefault();var i,a,n,o=this.get("container"),s=this,l=this.get("albumModel"),r=this.templates("flickr-balls")({}),d=o.one(".edit-cover-photo"),u=this.appContext.viewportData.getDevicePixelRatio();(i=new e.Views.FluidModal({appContext:s.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:"",navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:s.appContext,links:[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],enableSearch:!0}),actionButtonLabel:this.intlMessage({intlName:"common.SELECT"}),actionButtonDisabled:!0,subview:new e.Views["photo-selector-view"]({appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1},defaultSelected:{id:s.albumId,title:s.get("albumModel").getValue("title"),type:"set"}}),width:752,height:498,fullWindow:!0,classList:"photo-selector",hideModalOverlay:!1})).on("actionClick",function(t){d.replace(r);var h=i.get("subview").get("selected");this.appContext.getModel("photo-models",h).then(function(e){return(n=!1===l.hasPhoto(h)?l.registry.remote.addPhoto({setID:s.albumId,photoID:h},s.appContext).then(function(){return s.fire("subviewViewEvent","newPhotoAddedToAlbum",h),l.registry.remote.setPrimaryPhoto({photoId:h,albumId:s.albumId},s.appContext)}):l.registry.remote.setPrimaryPhoto({photoId:h,albumId:s.albumId},s.appContext)).then(function(t){a=e.getSizeToFit({width:.8*s.appContext.viewportData.getWidth()*u,height:(s.getAlbumHeaderHeight()-60)*u}),l.setValue("primary",e.id),l.setValue("primaryPhotoSizes",e.getValue("sizesForAlbum")),l.setValue("primaryNeedsInterstitial",e.getValue("needsInterstitial")),a&&o.one(".album-header-content").setStyle("background-image","url("+a.url+")"),o.one(".balls").replace(d)})}).then(null,function(t){new e.Views.FluidModal({title:s.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:s.intlMessage({intlName:"common.OK"}),textMessage:s.intlMessage({intlName:"album-page.ERROR_COVER_PHOTO"}),appContext:s.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!0}).show(),o.one(".balls").replace(d)})}),i.registerEventHandler(e.on("photoSelector:selected",function(e){i.enableActionButton()})),i.registerEventHandler(e.on("photoSelector:unselected",function(e){i.disableActionButton()})),e.rapidTracker.beacon(s.name,"albumCoverPhotoEdit"),i.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-album-header","hermes-template-flickr-balls"],optional:["album-title-desc-view","album-stats-view","album-engagement-view","photo-selector-view","fluid-modal-nav-bar-view","photo-list-photo-interaction-view","attribution-view"],langBundles:["album-page","global-nav","common"]});YUI.add("album-page-view",function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.albumId=t.albumId,this.isOwner=t.isOwner,this.isTwitterbot=t.isTwitterbot,this.albumPhotoListLayoutStyle=t.albumPhotoListLayoutStyle,t.id=t.albumId,t.modelRegistryName="set-models",t.maxNumAttrName="totalCount",this.pageParams=t.pageParams,t.photoListConfig={modelParams:{registryName:"set-models",modelIdOrAttributes:t.albumId,collectionAttributeName:"photoPageList"},parentName:this.name,pageParams:t.pageParams,contextSuffix:"album-"+t.albumId,measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:t.withPhotoId},t.photoListConfig.layout={targetRowHeight:"justified"===this.albumPhotoListLayoutStyle?190:430,fullWidthBreakoutRowCadence:"justified"===this.albumPhotoListLayoutStyle?null:3,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:4,right:0,bottom:4,left:0},itemSpacing:{horizontal:4,vertical:4}},this.aftHelper=new e.PhotolistAftHelper(this),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"album-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,disabled:function(){return!this.pageParams.viewPageSize}},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("set-models",this.albumId).then(function(t){e.set("albumModel",t)})},buildContainer:function(){return this.setContainerWithTemplate("album-page"),this},buildHeadContainer:function(){var t,a,o,r,l=this.get("albumModel"),s=l.getValue("photoPageList").getList(),n="summary",u=[],h=(this.pageParams.nominalPage-1)*this.pageParams.viewPageSizeForShare||0;if(this.isTwitterbot&&s.length-h>=4)for(n="gallery",o=0;o<Math.min(s.length-h,4);o++)if(s[h+o]){var m=s[h+o].getSizeToFit({width:640,height:640});m&&m.url&&u.push({property:"twitter:image"+o,content:m.url})}else i.error("Missing album photo in album list",{index:h+o});l.registry?t=l.registry.getSizeToFit(this.albumId,{width:640,height:640}):i.error("Missing album model registry"),r=l.getValue("url").replace(/\/albums\/([0-9]+)/i,"/sets/$1"),a=this.templates("dynamic-page-head")({title:l.getValue("title"),description:l.getValue("description")||this.intlMessage({intlName:"album-page.OPENGRAPH_DESCRIPTION",owner:l.getValue("owner").getValue("displayname")}),url:l.getValue("url"),fullURL:e.url(r),openGraphImageURL:t?e.URLHelper.addProtocolToURL(t.url):"",openGraphaImageWidth:t?t.width:"",openGraphaImageHeight:t?t.height:"",ownerURL:l.getValue("owner").getValue("url"),twitterCardType:n,twitterImages:u,ogType:"article",domain:e.url()}),a+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),a+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),a+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",a):(this.set("headContainer",a.concat(this.subviews["pagination-view"].get("headContainer"))),this.updateHead())},activate:function(){var t=this,i=this.get("albumModel"),a=i.getValue("isOwner");return e.later(100,this,function(){e.use("photo-page-scrappy-view")}),e.on("albumToolbarView:layoutChange",function(e){var i=t.subviews["photo-list-view"],a=i.photoListLayout;a.targetRowHeight="justified"===e?190:430,a.fullWidthBreakoutRowCadence="justified"===e?null:3,i.setItems(t.get("albumModel").getValue("photoPageList").getList())}),a||this.appContext.getViewCounter().recordAlbumView({albumOwnerID:i.getValue("owner").getValue("id"),albumID:i.getValue("id"),referrer:this.appContext.getReferrer()}),this},onSubviewEvent:function(e,t){t&&"newPhotoAddedToAlbum"===t[0]&&this.subviews["photo-list-view"].setItems(this.get("albumModel").getValue("photoPageList").getList())},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("albumModel").getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,vwrOwner:this.isOwner?1:0}}},{ATTRS:{spaceid:{value:792600538}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","set-models","hermes-template-album-page","hermes-template-dynamic-page-head","hermes-template-head-meta","hermes-template-head-link","album-toolbar-view","album-header-view","photo-list-view","footer-full-view","photolist-aft-helper","url-helper"],langBundles:["album-page"]});
YUI.add("albums-list-route",function(e){function t(e){t.superclass.constructor.call(this,e)}var a=require("hermes-core/type-validator");e.Routes[this.name]=t,e.extend(t,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(t){var s,i,o,n=this,r={},l=t.params.nsid_or_path_alias,u=t.params&&t.params.set_id,p=u?100:25,m=this.getPageNumber(t);return a.nsid(l)?r.id=l:r.pathAlias=l,i="/photos/"+l+"/albums/",s={page:100/p*(m-1)+1,perPage:p,withSetId:u},e.Promise.all([this.appContext.getModel("sets-models",r,s),this.appContext.getModel("person-models",r),this.appContext.getModel("person-contacts-count-models",r)]).then(function(r){var p=r[0],d=r[1],g=0;if(YUI.Env.isServer&&(g=Math.ceil(p.getValue("totalItems")/100),m>g&&s.page>1&&!isNaN(parseInt(t.params.page_number,10))))return e.Promise.resolve({redirect:i.replace(/page[0-9]+/,"")});if(u){var c=p.getValue("albumsList");if(-1===(o=c.getPageOf({id:u},50))||c.getNextIncompletePage(s)===o)return s.forceAPICall=!0,a.nsid(l)?s.id=l:s.pathAlias=l,c.getPage(s).then(function(e){return m=Math.ceil(50*c.getPageOf({id:u},50)/100),o=m,n.onRouteResolved(p,d,m,o,i,u)},function(t){return e.Promise.resolve({redirect:i})});m=Math.ceil(50*o/100),o=m}else o=2*(m-1)+1;return n.onRouteResolved(p,d,m,o,i,u)},function(a){return a&&u?e.Promise.resolve({redirect:i}):a.timeout?n.appContext.getModel("person-models",r).then(function(t){var a=t.getValue("displayname"),s={view:"empty-page-view",layout:"scrolling",title:n.intlMessage({intlName:"common.USERS_ALBUMS",who:a}),params:{isSlow:!0,page:"albums",displayName:a,nsid:t.getValue("nsid")}};return e.Promise.resolve(s)},function(){return n.onRouteRejected(a,t)}):n.onRouteRejected(a,t)})},onRouteResolved:function(t,a,s,i,o,n){var r,l=t.getValue("totalItems"),u=a.getValue("displayname");return r=0===parseInt(l,10)&&this.appContext.flipper.isFlipped("enable-new-empty-state-pages")?{view:"empty-page-view",layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:u}),params:{displayName:u,nsid:a.getValue("nsid"),page:"albums"}}:{view:"albums-list-page-view",layout:"scrolling",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:u}),params:{nsid:t.id,withSetId:n,pageParams:{page:i,perPage:n?100:50,viewPageSize:100,nominalPage:s},baseURL:o}},e.Promise.resolve(r)},onRouteRejected:function(t,a){if(t.fatal)throw t;return this.displayRouteErrors(a,new e.RouteError(404,this.intlMessage({intlName:"common.404_PERSON_NONEXISTENT"})))}}),e.mix(t.prototype,e.Localizable)},"@VERSION@",{requires:["flickr-route","flickr-promise","sets-models","person-models"],langBundles:["common"]});